apiVersion: v1
kind: ConfigMap
metadata:
  name: yagok-ssr-mobile-config
  namespace: {{ K8S_NAMESPACE }}
data:
  BotConfig__ApiBaseUrl: https://{{ SQP_DOMAIN_NAME }}/
  BotConfig__BOT_CTS: https://{{ BOT_CTS }}/
  BotConfig__BOT_ID: "{{ BOT_ID }}"
  Replaces__0__originalString: https://{{ SQP_DOMAIN_NAME }}/api/api/data/storage/media/
  Replaces__0__replacedString: https://{{ BOT_CTS }}/api/v1/file_service/smartapp_files/{{ BOT_ID }}/static/content_holder/
  Replaces__1__originalString: https://{{ SQP_DOMAIN_NAME }}/
  Replaces__1__replacedString: "./"
  StaticFileConfig__StaticFilesOrigin: https://{{ BOT_CTS }}/api/api/data/storage/media/
  StaticFileConfig__Headers__0__Value: https://{{ SQP_DOMAIN_NAME }}/
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: yagok-ssr-mobile-cache-nginx-template
  namespace: {{ K8S_NAMESPACE }}
data:
  default.conf.template: |
    server {
        listen                      80;
        server_name                 yagoksmart.kube.severstal.severstalgroup.com;
        location                    /api/ {
            rewrite                 /api/(.*) /$1  break;
            proxy_pass              http://stal-dtl-psql1:3000;
            proxy_hide_header       Access-Control-Allow-Origin;
            add_header              Access-Control-Allow-Origin * always;
            add_header              "Access-Control-Allow-Headers" "*";
            add_header              "Access-Control-Allow-Methods" "GET, POST, PUT, DELETE, OPTIONS";
            proxy_set_header        Connection keep-alive;
            proxy_set_header        Accept-Encoding "";
            proxy_set_header        Host stal-dtl-psql1;
            proxy_set_header        Authorization "Bearer $TOKEN";
            proxy_set_header X-Real-IP          $remote_addr;
            proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto  $scheme;
            proxy_set_header X-Forwarded-Port   $server_port;
            proxy_set_header Upgrade            $http_upgrade;
            proxy_set_header Connection         "Upgrade";
            proxy_read_timeout                  5m;
            proxy_send_timeout                  5m;
        }
    }
